<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Matches</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #fff;
}
header {
  padding: 12px;
  background: #151515;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
}
#searchBox {
  width: 95%;
  margin: 10px auto;
  display: block;
  padding: 10px;
  border-radius: 6px;
  border: none;
  font-size: 16px;
}
#playerContainer {
  display: none;
  background: #000;
}
#playerContainer iframe {
  width: 100%;
  height: 240px;
  border: none;
}
.category {
  padding: 10px;
}
.category h2 {
  margin: 10px 0;
  border-bottom: 1px solid #333;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
}
.card {
  background: #181818;
  border-radius: 8px;
  padding: 8px;
  cursor: pointer;
  transition: transform .15s;
}
.card:hover {
  transform: scale(1.05);
}
.card img {
  width: 100%;
  height: 80px;
  object-fit: contain;
  border-radius: 4px;
}
.card .name {
  font-size: 14px;
  margin-top: 6px;
  text-align: center;
}
.live {
  color: #00ff66;
  font-size: 12px;
  text-align: center;
}
.error {
  color: red;
  text-align: center;
  margin-top: 20px;
}
</style>
</head>

<body>

<header>LIVE MATCHES</header>

<input id="searchBox" placeholder="Search matches or channels...">

<div id="playerContainer">
  <iframe id="playerFrame" allow="autoplay; fullscreen"></iframe>
</div>

<div id="content"></div>

<script>
const API = "https://webiptv.site/api/live.json";
const content = document.getElementById("content");
const searchBox = document.getElementById("searchBox");
const playerContainer = document.getElementById("playerContainer");
const playerFrame = document.getElementById("playerFrame");

let allData = [];

async function loadData() {
  try {
    const res = await fetch(API);
    const data = await res.json();
    allData = data.categories || [];
    render(allData);
  } catch (e) {
    content.innerHTML = "<div class='error'>Failed to load live data</div>";
  }
}

function render(categories) {
  content.innerHTML = "";
  categories.forEach(cat => {
    const section = document.createElement("div");
    section.className = "category";
    section.innerHTML = `<h2>${cat.title}</h2>`;

    const grid = document.createElement("div");
    grid.className = "grid";

    cat.channels.forEach(ch => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${ch.thumb || ""}">
        <div class="name">${ch.name}</div>
        <div class="live">LIVE</div>
      `;
      card.onclick = () => playStream(ch.url);
      grid.appendChild(card);
    });

    section.appendChild(grid);
    content.appendChild(section);
  });
}

function playStream(url) {
  playerContainer.style.display = "block";
  const finalUrl = /\.m3u8/i.test(url)
    ? `https://webiptv.site/jwlatest?url=${encodeURIComponent(url)}`
    : url;
  playerFrame.src = finalUrl;
  window.scrollTo({ top: 0, behavior: "smooth" });
}

searchBox.addEventListener("input", () => {
  const q = searchBox.value.toLowerCase();
  const filtered = allData.map(cat => ({
    ...cat,
    channels: cat.channels.filter(c =>
      c.name.toLowerCase().includes(q)
    )
  })).filter(c => c.channels.length);
  render(filtered);
});

// auto update every 60 sec
loadData();
setInterval(loadData, 60000);
</script>

</body>
</html>
